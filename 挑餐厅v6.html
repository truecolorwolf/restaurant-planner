<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœˆåº¦é¤å…éšæœºé€‰æ‹©å·¥å…·</title>
    <style>

/* æ–°å¢çš„å…³é—­æŒ‰é’®æ ·å¼ */
        .close-btn-container {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
        }
        .close-btn {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .close-btn:hover {
            background-color: #d32f2f;
        }
        :root {
            --primary-color: #4CAF50;
            --primary-hover: #45a049;
            --secondary-color: #2196F3;
            --secondary-hover: #0b7dda;
            --reset-color: #f44336;
            --reset-hover: #d32f2f;
            --copy-color: #9c27b0;
            --copy-hover: #7b1fa2;
        }
        
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 100%;
            margin: 0;
            padding: 15px;
            background-color: #f5f5f5;
            line-height: 1.5;
        }
        
        h1 {
            color: #333;
            text-align: center;
            font-size: 1.5rem;
            margin-bottom: 20px;
        }
        
        .container {
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .input-group {
            margin-bottom: 15px;
            position: relative;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        input[type="text"], 
        input[type="month"],
        select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            background-color: #fff;
        }
        
        button {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            transition: background-color 0.3s;
            font-size: 1rem;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-hover);
        }
        
        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: var(--secondary-hover);
        }
        
        .btn-reset {
            background-color: var(--reset-color);
            color: white;
        }
        
        .btn-reset:hover {
            background-color: var(--reset-hover);
        }
        
        .btn-copy {
            background-color: var(--copy-color);
            color: white;
        }
        
        .btn-copy:hover {
            background-color: var(--copy-hover);
        }
        
        button:disabled {
            background-color: #cccccc !important;
            cursor: not-allowed;
        }
        
        .priority-days {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .day-checkbox {
            display: flex;
            align-items: center;
        }
        
        .day-checkbox input {
            margin-right: 8px;
            width: 20px;
            height: 20px;
        }
        
        .priority-restaurant {
            margin-top: 10px;
            display: none;
        }
        
        .result-section {
            margin-top: 30px;
            display: none;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 0.9rem;
            word-break: break-word;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        
        th {
            background-color: #f2f2f2;
            position: sticky;
            top: 0;
        }
        
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .saved-restaurants {
            margin-top: 5px;
            font-size: 0.9rem;
            color: #666;
        }
        
        .saved-restaurants span {
            margin-right: 8px;
            display: inline-block;
            margin-bottom: 5px;
            background-color: #f0f0f0;
            padding: 3px 8px;
            border-radius: 4px;
        }
        
        .clear-history {
            display: inline-block;
            margin-top: 5px;
            color: #666;
            text-decoration: underline;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .date-options {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .date-option {
            display: flex;
            align-items: center;
        }
        
        .date-option input {
            margin-right: 8px;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .action-buttons button {
            flex: 1;
            margin-top: 0;
        }
        
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            z-index: 1000;
            display: none;
        }
        
        @media (min-width: 768px) {
            body {
                max-width: 800px;
                margin: 0 auto;
                padding: 20px;
            }
            
            .priority-days {
                grid-template-columns: repeat(4, 1fr);
            }
            
            table {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>

<!-- æ–°å¢çš„å…³é—­æŒ‰é’® -->
    <div class="close-btn-container">
        <button class="close-btn" onclick="window.location.href='index.html'">å…³é—­</button>
    </div>

    <div class="container">
        <h1>æœˆåº¦é¤å…éšæœºé€‰æ‹©å·¥å…·</h1>
        
        <div class="input-group">
            <label for="restaurants">å¯é€‰é¤å…ï¼ˆç”¨ç©ºæ ¼åˆ†éš”ï¼‰ï¼š</label>
            <input type="text" id="restaurants" placeholder="ä¾‹å¦‚: é¤å…A é¤å…B é¤å…C">
            <div class="saved-restaurants" id="savedRestaurants"></div>
            <div class="clear-history" id="clearHistory">æ¸…é™¤å†å²è®°å½•</div>
        </div>
        
        <div class="input-group">
            <label>æ—¥æœŸèŒƒå›´ï¼š</label>
            <div class="date-options">
                <div class="date-option">
                    <input type="radio" id="all-days" name="date-range" value="all" checked>
                    <label for="all-days">å…¨éƒ¨æ—¥æœŸ</label>
                </div>
                <div class="date-option">
                    <input type="radio" id="work-days" name="date-range" value="work">
                    <label for="work-days">ä»…å·¥ä½œæ—¥ï¼ˆå‘¨ä¸€è‡³å‘¨äº”ï¼‰</label>
                </div>
            </div>
        </div>
        
        <div class="input-group">
            <label>ä¼˜å…ˆæ—¥é€‰æ‹©ï¼š</label>
            <div class="priority-days" id="priorityDaysContainer">
                <div class="day-checkbox">
                    <input type="checkbox" id="monday" value="æ˜ŸæœŸä¸€">
                    <label for="monday">æ˜ŸæœŸä¸€</label>
                </div>
                <div class="day-checkbox">
                    <input type="checkbox" id="tuesday" value="æ˜ŸæœŸäºŒ">
                    <label for="tuesday">æ˜ŸæœŸäºŒ</label>
                </div>
                <div class="day-checkbox">
                    <input type="checkbox" id="wednesday" value="æ˜ŸæœŸä¸‰">
                    <label for="wednesday">æ˜ŸæœŸä¸‰</label>
                </div>
                <div class="day-checkbox">
                    <input type="checkbox" id="thursday" value="æ˜ŸæœŸå››">
                    <label for="thursday">æ˜ŸæœŸå››</label>
                </div>
                <div class="day-checkbox">
                    <input type="checkbox" id="friday" value="æ˜ŸæœŸäº”">
                    <label for="friday">æ˜ŸæœŸäº”</label>
                </div>
                <div class="day-checkbox">
                    <input type="checkbox" id="saturday" value="æ˜ŸæœŸå…­">
                    <label for="saturday">æ˜ŸæœŸå…­</label>
                </div>
                <div class="day-checkbox">
                    <input type="checkbox" id="sunday" value="æ˜ŸæœŸæ—¥">
                    <label for="sunday">æ˜ŸæœŸæ—¥</label>
                </div>
            </div>
        </div>
        
        <div id="priorityRestaurantsContainer">
            <!-- åŠ¨æ€ç”Ÿæˆçš„ä¼˜å…ˆæ—¥é¤å…é€‰æ‹©å™¨ -->
        </div>
        
        <div class="input-group">
            <label for="month">é€‰æ‹©å¹´æœˆï¼š</label>
            <input type="month" id="month">
        </div>
        
        <button id="generateBtn" class="btn-primary">ç”Ÿæˆæœˆåº¦é¤å…è®¡åˆ’</button>
        <button id="resetBtn" class="btn-reset">é‡ç½®</button>
        
        <div class="result-section" id="resultSection">
            <h2>ç”Ÿæˆçš„æœˆåº¦é¤å…è®¡åˆ’</h2>
            <div id="calendarTable"></div>
            <div class="action-buttons">
                <button class="btn-secondary" id="downloadBtn">ä¸‹è½½Excelæ–‡ä»¶</button>
                <button class="btn-copy" id="copyBtn">å¤åˆ¶æ–‡æœ¬</button>
            </div>
        </div>
        
        <div class="toast" id="toast">å·²å¤åˆ¶åˆ°å‰ªè´´æ¿</div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // è·å–DOMå…ƒç´ 
            const restaurantsInput = document.getElementById('restaurants');
            const savedRestaurantsContainer = document.getElementById('savedRestaurants');
            const clearHistoryBtn = document.getElementById('clearHistory');
            const priorityDaysContainer = document.getElementById('priorityDaysContainer');
            const priorityRestaurantsContainer = document.getElementById('priorityRestaurantsContainer');
            const generateBtn = document.getElementById('generateBtn');
            const resetBtn = document.getElementById('resetBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            const copyBtn = document.getElementById('copyBtn');
            const resultSection = document.getElementById('resultSection');
            const toast = document.getElementById('toast');
            const allDaysRadio = document.getElementById('all-days');
            const workDaysRadio = document.getElementById('work-days');
            
            // åˆå§‹åŒ–æœ¬åœ°å­˜å‚¨
            const STORAGE_KEY = 'restaurantPlannerData';
            let savedData = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {
                restaurants: [],
                prioritySettings: {},
                dateRange: 'all'
            };
            
            // åŠ è½½ä¿å­˜çš„æ•°æ®
            loadSavedData();
            
            // è®¾ç½®è¾“å…¥ç›‘å¬å™¨
            setupInputListeners();
            
            // ç›‘å¬é¤å…è¾“å…¥å˜åŒ–
            restaurantsInput.addEventListener('input', updatePriorityRestaurantSelectors);
            
            // ç›‘å¬ä¼˜å…ˆæ—¥é€‰æ‹©å˜åŒ–
            priorityDaysContainer.addEventListener('change', function(e) {
                if (e.target.type === 'checkbox') {
                    updatePriorityRestaurantSelectors();
                    checkInputChange();
                }
            });
            
            // ç‚¹å‡»ä¿å­˜çš„é¤å…é¡¹
            savedRestaurantsContainer.addEventListener('click', function(e) {
                if (e.target.classList.contains('saved-item')) {
                    restaurantsInput.value = e.target.textContent;
                    updatePriorityRestaurantSelectors();
                    checkInputChange();
                }
            });
            
            // æ¸…é™¤å†å²è®°å½•
            clearHistoryBtn.addEventListener('click', function() {
                if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰å†å²è®°å½•å—ï¼Ÿ')) {
                    savedData = {
                        restaurants: [],
                        prioritySettings: {},
                        dateRange: 'all'
                    };
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(savedData));
                    loadSavedData();
                    allDaysRadio.checked = true;
                    checkInputChange();
                }
            });
            
            // æ—¥æœŸèŒƒå›´é€‰æ‹©å˜åŒ–
            allDaysRadio.addEventListener('change', function() {
                savedData.dateRange = 'all';
                localStorage.setItem(STORAGE_KEY, JSON.stringify(savedData));
                checkInputChange();
            });
            
            workDaysRadio.addEventListener('change', function() {
                savedData.dateRange = 'work';
                localStorage.setItem(STORAGE_KEY, JSON.stringify(savedData));
                checkInputChange();
            });
            
            // ç”ŸæˆæŒ‰é’®ç‚¹å‡»äº‹ä»¶
            generateBtn.addEventListener('click', generateCalendar);
            
            // é‡ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            resetBtn.addEventListener('click', resetForm);
            
            // ä¸‹è½½æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            downloadBtn.addEventListener('click', downloadExcel);
            
            // å¤åˆ¶æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            copyBtn.addEventListener('click', copyToClipboard);
            
            // è®¾ç½®è¾“å…¥ç›‘å¬å™¨
            function setupInputListeners() {
                const inputs = [
                    restaurantsInput,
                    document.getElementById('month'),
                    ...priorityDaysContainer.querySelectorAll('input[type="checkbox"]'),
                    allDaysRadio,
                    workDaysRadio
                ];
                
                inputs.forEach(input => {
                    input.addEventListener('change', checkInputChange);
                });
            }
            
            // æ£€æŸ¥è¾“å…¥å˜åŒ–
            function checkInputChange() {
                if (generateBtn.disabled) {
                    generateBtn.disabled = false;
                    generateBtn.textContent = 'é‡æ–°ç”Ÿæˆæœˆåº¦é¤å…è®¡åˆ’';
                }
            }
            
            // é‡ç½®è¡¨å•
            function resetForm() {
                // æ¸…ç©ºç»“æœåŒºåŸŸ
                document.getElementById('calendarTable').innerHTML = '';
                resultSection.style.display = 'none';
                
                // é‡ç½®ç”ŸæˆæŒ‰é’®
                generateBtn.disabled = false;
                generateBtn.textContent = 'ç”Ÿæˆæœˆåº¦é¤å…è®¡åˆ’';
                
                // æ»šåŠ¨åˆ°é¡¶éƒ¨
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
            
            // å¤åˆ¶æ–‡æœ¬åˆ°å‰ªè´´æ¿
            function copyToClipboard() {
                if (!window.calendarData || window.calendarData.length === 0) {
                    alert('æ²¡æœ‰å¯å¤åˆ¶çš„æ•°æ®ï¼è¯·å…ˆç”Ÿæˆè®¡åˆ’');
                    return;
                }
                
                // æ„å»ºå¤åˆ¶æ–‡æœ¬
                let textToCopy = "ğŸ´ æœˆåº¦é¤å…è®¡åˆ’ ğŸ´\n\n";
                textToCopy += "æ—¥æœŸ\t\tæ˜ŸæœŸ\té¤å…\n";
                textToCopy += "--------------------------------\n";
                
                window.calendarData.forEach(day => {
                    textToCopy += `${day.date}\t${day.dayOfWeek}\t${day.restaurant}\n`;
                });
                
                // ä½¿ç”¨ç°ä»£å‰ªè´´æ¿API
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(textToCopy).then(() => {
                        showToast();
                    }).catch(err => {
                        fallbackCopy(textToCopy);
                    });
                } else {
                    fallbackCopy(textToCopy);
                }
            }
            
            // å…¼å®¹æ—§æµè§ˆå™¨çš„å¤åˆ¶æ–¹æ³•
            function fallbackCopy(text) {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.style.opacity = 0;
                document.body.appendChild(textarea);
                textarea.select();
                
                try {
                    document.execCommand('copy');
                    showToast();
                } catch (err) {
                    alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©æ–‡æœ¬å¤åˆ¶');
                }
                
                document.body.removeChild(textarea);
            }
            
            // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸçš„æç¤º
            function showToast() {
                toast.style.display = 'block';
                setTimeout(() => {
                    toast.style.display = 'none';
                }, 2000);
            }
            
            // åŠ è½½ä¿å­˜çš„æ•°æ®
            function loadSavedData() {
                // æ˜¾ç¤ºä¿å­˜çš„é¤å…åˆ—è¡¨
                updateSavedRestaurantsDisplay();
                
                // å¦‚æœæœ‰ä¿å­˜çš„é¤å…ï¼Œå¡«å……åˆ°è¾“å…¥æ¡†
                if (savedData.restaurants.length > 0) {
                    restaurantsInput.value = savedData.restaurants[0];
                    updatePriorityRestaurantSelectors();
                }
                
                // è®¾ç½®æ—¥æœŸèŒƒå›´é€‰é¡¹
                if (savedData.dateRange === 'work') {
                    workDaysRadio.checked = true;
                } else {
                    allDaysRadio.checked = true;
                }
            }
            
            // æ›´æ–°ä¿å­˜çš„é¤å…æ˜¾ç¤º
            function updateSavedRestaurantsDisplay() {
                savedRestaurantsContainer.innerHTML = '';
                
                if (savedData.restaurants.length === 0) {
                    savedRestaurantsContainer.innerHTML = '<em>æš‚æ— å†å²è®°å½•</em>';
                    return;
                }
                
                savedData.restaurants.forEach(restaurant => {
                    const span = document.createElement('span');
                    span.className = 'saved-item';
                    span.textContent = restaurant;
                    span.title = 'ç‚¹å‡»ä½¿ç”¨æ­¤åˆ—è¡¨';
                    savedRestaurantsContainer.appendChild(span);
                });
            }
            
            // ä¿å­˜å½“å‰é¤å…åˆ—è¡¨
            function saveRestaurantsList(restaurants) {
                const restaurantStr = restaurants.join(' ');
                
                // å¦‚æœå·²ç»å­˜åœ¨ï¼Œå…ˆç§»é™¤
                savedData.restaurants = savedData.restaurants.filter(r => r !== restaurantStr);
                
                // æ·»åŠ åˆ°æ•°ç»„å¼€å¤´
                savedData.restaurants.unshift(restaurantStr);
                
                // æœ€å¤šä¿å­˜5æ¡è®°å½•
                if (savedData.restaurants.length > 5) {
                    savedData.restaurants = savedData.restaurants.slice(0, 5);
                }
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                localStorage.setItem(STORAGE_KEY, JSON.stringify(savedData));
                
                // æ›´æ–°æ˜¾ç¤º
                updateSavedRestaurantsDisplay();
            }
            
            // æ›´æ–°ä¼˜å…ˆæ—¥é¤å…é€‰æ‹©å™¨
            function updatePriorityRestaurantSelectors() {
                const restaurants = restaurantsInput.value.trim().split(/\s+/).filter(Boolean);
                const checkedDays = Array.from(priorityDaysContainer.querySelectorAll('input[type="checkbox"]:checked'));
                
                // æ¸…ç©ºå®¹å™¨
                priorityRestaurantsContainer.innerHTML = '';
                
                if (restaurants.length === 0) {
                    return;
                }
                
                checkedDays.forEach(day => {
                    const dayValue = day.value;
                    const dayId = day.id;
                    
                    const group = document.createElement('div');
                    group.className = 'input-group priority-restaurant';
                    group.id = `priority-group-${dayId}`;
                    
                    const label = document.createElement('label');
                    label.textContent = `${dayValue}ä¼˜å…ˆé¤å…:`;
                    label.htmlFor = `priority-${dayId}`;
                    
                    const select = document.createElement('select');
                    select.id = `priority-${dayId}`;
                    select.dataset.day = dayValue;
                    
                    // æ·»åŠ é»˜è®¤é€‰é¡¹
                    const defaultOption = document.createElement('option');
                    defaultOption.value = '';
                    defaultOption.textContent = '-- è¯·é€‰æ‹© --';
                    select.appendChild(defaultOption);
                    
                    // æ·»åŠ é¤å…é€‰é¡¹
                    restaurants.forEach(restaurant => {
                        const option = document.createElement('option');
                        option.value = restaurant;
                        option.textContent = restaurant;
                        
                        // æ£€æŸ¥æ˜¯å¦æœ‰ä¿å­˜çš„ä¼˜å…ˆè®¾ç½®
                        if (savedData.prioritySettings[dayValue] === restaurant) {
                            option.selected = true;
                        }
                        
                        select.appendChild(option);
                    });
                    
                    // ç›‘å¬é€‰æ‹©å˜åŒ–
                    select.addEventListener('change', function() {
                        checkInputChange();
                    });
                    
                    group.appendChild(label);
                    group.appendChild(select);
                    priorityRestaurantsContainer.appendChild(group);
                    
                    // æ˜¾ç¤ºè¯¥ç»„
                    group.style.display = 'block';
                });
            }
            
            function generateCalendar() {
                // è·å–ç”¨æˆ·è¾“å…¥
                const restaurantsInputValue = restaurantsInput.value.trim();
                const monthInput = document.getElementById('month').value;
                const isWorkDaysOnly = workDaysRadio.checked;
                
                // éªŒè¯è¾“å…¥
                if (!restaurantsInputValue) {
                    alert('è¯·è¾“å…¥è‡³å°‘ä¸€ä¸ªé¤å…ï¼');
                    return;
                }
                
                if (!monthInput) {
                    alert('è¯·é€‰æ‹©å¹´æœˆï¼');
                    return;
                }
                
                // è§£æé¤å…åˆ—è¡¨
                const allRestaurants = restaurantsInputValue.split(/\s+/).filter(Boolean);
                
                // ä¿å­˜å½“å‰é¤å…åˆ—è¡¨
                saveRestaurantsList(allRestaurants);
                
                // è·å–ä¼˜å…ˆæ—¥è®¾ç½®
                const prioritySettings = {};
                const prioritySelects = priorityRestaurantsContainer.querySelectorAll('select');
                
                prioritySelects.forEach(select => {
                    const day = select.dataset.day;
                    const restaurant = select.value;
                    
                    if (restaurant) {
                        prioritySettings[day] = restaurant;
                    }
                });
                
                // ä¿å­˜ä¼˜å…ˆè®¾ç½®
                savedData.prioritySettings = prioritySettings;
                savedData.dateRange = isWorkDaysOnly ? 'work' : 'all';
                localStorage.setItem(STORAGE_KEY, JSON.stringify(savedData));
                
                // è§£æå¹´æœˆ
                const [year, month] = monthInput.split('-').map(Number);
                
                // è·å–è¯¥æœˆçš„å¤©æ•°
                const daysInMonth = new Date(year, month, 0).getDate();
                
                // åˆ›å»ºæ—¥æœŸæ•°ç»„
                const calendar = [];
                
                // åˆ›å»ºå¯ç”¨é¤å…æ± ï¼ˆæ·±æ‹·è´ï¼‰
                let availableRestaurants = [...allRestaurants];
                
                for (let day = 1; day <= daysInMonth; day++) {
                    const date = new Date(year, month - 1, day);
                    const dayOfWeek = getDayOfWeekChinese(date.getDay());
                    
                    // å¦‚æœåªé€‰æ‹©å·¥ä½œæ—¥ä¸”æ˜¯å‘¨æœ«ï¼Œè·³è¿‡
                    if (isWorkDaysOnly && (dayOfWeek === 'æ˜ŸæœŸå…­' || dayOfWeek === 'æ˜ŸæœŸæ—¥')) {
                        continue;
                    }
                    
                    let selectedRestaurant = '';
                    
                    // æ£€æŸ¥æ˜¯å¦æ˜¯ä¼˜å…ˆæ—¥ä¸”æœ‰è®¾ç½®ä¼˜å…ˆé¤å…
                    if (prioritySettings[dayOfWeek]) {
                        selectedRestaurant = prioritySettings[dayOfWeek];
                    } else {
                        // ä»æ™®é€šé¤å…ä¸­é€‰æ‹©
                        if (availableRestaurants.length === 0) {
                            availableRestaurants = [...allRestaurants];
                        }
                        
                        const randomIndex = Math.floor(Math.random() * availableRestaurants.length);
                        selectedRestaurant = availableRestaurants[randomIndex];
                        
                        // ä»å¯ç”¨é¤å…ä¸­ç§»é™¤
                        availableRestaurants.splice(randomIndex, 1);
                    }
                    
                    calendar.push({
                        date: `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`,
                        dayOfWeek,
                        restaurant: selectedRestaurant
                    });
                }
                
                // æ˜¾ç¤ºç»“æœ
                displayCalendar(calendar);
                resultSection.style.display = 'block';
                
                // ç¦ç”¨ç”ŸæˆæŒ‰é’®
                generateBtn.disabled = true;
                
                // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
                resultSection.scrollIntoView({ behavior: 'smooth' });
                
                // ä¿å­˜æ•°æ®ä¾›ä¸‹è½½ä½¿ç”¨
                window.calendarData = calendar;
            }
            
            function getDayOfWeekChinese(day) {
                const days = ['æ˜ŸæœŸæ—¥', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­'];
                return days[day];
            }
            
            function displayCalendar(calendar) {
                const table = document.createElement('table');
                
                // åˆ›å»ºè¡¨å¤´
                const thead = document.createElement('thead');
                const headerRow = document.createElement('tr');
                ['æ—¥æœŸ', 'æ˜ŸæœŸ', 'é¤å…'].forEach(text => {
                    const th = document.createElement('th');
                    th.textContent = text;
                    headerRow.appendChild(th);
                });
                thead.appendChild(headerRow);
                table.appendChild(thead);
                
                // åˆ›å»ºè¡¨ä½“
                const tbody = document.createElement('tbody');
                calendar.forEach(day => {
                    const row = document.createElement('tr');
                    
                    const dateCell = document.createElement('td');
                    dateCell.textContent = day.date;
                    row.appendChild(dateCell);
                    
                    const dayCell = document.createElement('td');
                    dayCell.textContent = day.dayOfWeek;
                    row.appendChild(dayCell);
                    
                    const restaurantCell = document.createElement('td');
                    restaurantCell.textContent = day.restaurant;
                    row.appendChild(restaurantCell);
                    
                    tbody.appendChild(row);
                });
                table.appendChild(tbody);
                
                // æ›´æ–°DOM
                const tableContainer = document.getElementById('calendarTable');
                tableContainer.innerHTML = '';
                tableContainer.appendChild(table);
            }
            
            function downloadExcel() {
                if (!window.calendarData || window.calendarData.length === 0) {
                    alert('æ²¡æœ‰å¯ä¸‹è½½çš„æ•°æ®ï¼');
                    return;
                }
                
                // åˆ›å»ºCSVå†…å®¹
                let csvContent = "æ—¥æœŸ,æ˜ŸæœŸ,é¤å…\n";
                
                window.calendarData.forEach(day => {
                    csvContent += `${day.date},${day.dayOfWeek},${day.restaurant}\n`;
                });
                
                // åˆ›å»ºBlobå¯¹è±¡
                const blob = new Blob(["\uFEFF"+csvContent], { type: 'text/csv;charset=utf-8;' });
                
                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                
                // è·å–å¹´æœˆç”¨äºæ–‡ä»¶å
                const monthInput = document.getElementById('month').value;
                const [year, month] = monthInput.split('-');
                const fileName = `é¤å…è®¡åˆ’_${year}å¹´${month}æœˆ.csv`;
                
                link.setAttribute('href', url);
                link.setAttribute('download', fileName);
                link.style.visibility = 'hidden';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        });
    </script>
</body>
</html>